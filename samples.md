---
layout: page
title: Code Samples
description: ""
group: navigation
---
{% include JB/setup %}
<script type="text/javascript"><!--
document.write('<link rel="stylesheet" href="https://gist.github.com/stylesheets/gist/embed.css"/>')

document.write('<div id=\"gist-2159563\" class=\"gist\">\n\n        <div class=\"gist-file\">\n          <div class=\"gist-data gist-syntax\">\n              <div class=\"gist-highlight\"><pre><div class=\'line\' id=\'LC1\'><span class=\"cp\">&lt;?php<\/span><\/div><div class=\'line\' id=\'LC2\'><span class=\"cm\">/* index.php */<\/span><\/div><div class=\'line\' id=\'LC3\'><br/><\/div><div class=\'line\' id=\'LC4\'><span class=\"c1\">// Determine that we&#39;re on the right subdomain, if not, redirect<\/span><\/div><div class=\'line\' id=\'LC5\'>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"k\">if<\/span> <span class=\"p\">(<\/span><span class=\"nv\">$host<\/span> <span class=\"o\">=<\/span> <span class=\"nx\">Helper<\/span><span class=\"o\">::<\/span><span class=\"na\">target_subdomain<\/span><span class=\"p\">(<\/span><span class=\"nv\">$req<\/span><span class=\"o\">-&gt;<\/span><span class=\"na\">getHttpHost<\/span><span class=\"p\">()))<\/span> <span class=\"p\">{<\/span><\/div><div class=\'line\' id=\'LC6\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"nv\">$scheme<\/span> <span class=\"o\">=<\/span> <span class=\"p\">(<\/span><span class=\"nv\">$req<\/span><span class=\"o\">-&gt;<\/span><span class=\"na\">isSecure<\/span><span class=\"p\">())<\/span> <span class=\"o\">?<\/span> <span class=\"s1\">&#39;https://&#39;<\/span> <span class=\"o\">:<\/span> <span class=\"s1\">&#39;http://&#39;<\/span><span class=\"p\">;<\/span><\/div><div class=\'line\' id=\'LC7\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"nv\">$uri<\/span> <span class=\"o\">=<\/span> <span class=\"nv\">$req<\/span><span class=\"o\">-&gt;<\/span><span class=\"na\">getRequestUri<\/span><span class=\"p\">();<\/span><\/div><div class=\'line\' id=\'LC8\'><br/><\/div><div class=\'line\' id=\'LC9\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"nv\">$url<\/span> <span class=\"o\">=<\/span> <span class=\"s2\">&quot;<\/span><span class=\"si\">$scheme$host$uri<\/span><span class=\"s2\">&quot;<\/span><span class=\"p\">;<\/span><\/div><div class=\'line\' id=\'LC10\'><br/><\/div><div class=\'line\' id=\'LC11\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"k\">return<\/span> <span class=\"nv\">$app<\/span><span class=\"o\">-&gt;<\/span><span class=\"na\">redirect<\/span><span class=\"p\">(<\/span><span class=\"nv\">$url<\/span><span class=\"p\">);<\/span><\/div><div class=\'line\' id=\'LC12\'>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"p\">}<\/span><\/div><div class=\'line\' id=\'LC13\'><br/><\/div><div class=\'line\' id=\'LC14\'><span class=\"cm\">/* Rokkan/Helper.php */<\/span><\/div><div class=\'line\' id=\'LC15\'><br/><\/div><div class=\'line\' id=\'LC16\'><br/><\/div><div class=\'line\' id=\'LC17\'><span class=\"sd\">/**<\/span><\/div><div class=\'line\' id=\'LC18\'><span class=\"sd\">     * Determine, based off of the current request host and the device, the most appropriate<\/span><\/div><div class=\'line\' id=\'LC19\'><span class=\"sd\">     * subdomain to redirect to. If the request host already matches this recommended subdomain,<\/span><\/div><div class=\'line\' id=\'LC20\'><span class=\"sd\">     * return boolean false, to indicate that no redirect is needed.<\/span><\/div><div class=\'line\' id=\'LC21\'><span class=\"sd\">     *<\/span><\/div><div class=\'line\' id=\'LC22\'><span class=\"sd\">     * @param string $request_host HTTP_HOST string for the current request<\/span><\/div><div class=\'line\' id=\'LC23\'><span class=\"sd\">     * @return string|boolean Redirect host string, with new subdomain, or boolean false if no<\/span><\/div><div class=\'line\' id=\'LC24\'><span class=\"sd\">     *                        redirect is needed.<\/span><\/div><div class=\'line\' id=\'LC25\'><span class=\"sd\">     */<\/span><\/div><div class=\'line\' id=\'LC26\'>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"k\">public<\/span> <span class=\"k\">static<\/span> <span class=\"k\">function<\/span> <span class=\"nf\">target_subdomain<\/span><span class=\"p\">(<\/span><span class=\"nv\">$request_host<\/span><span class=\"p\">)<\/span> <span class=\"p\">{<\/span><\/div><div class=\'line\' id=\'LC27\'><br/><\/div><div class=\'line\' id=\'LC28\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"k\">list<\/span><span class=\"p\">(<\/span><span class=\"nv\">$current_sub<\/span><span class=\"p\">,<\/span> <span class=\"nv\">$domain<\/span><span class=\"p\">)<\/span> <span class=\"o\">=<\/span> <span class=\"nx\">self<\/span><span class=\"o\">::<\/span><span class=\"na\">split_host<\/span><span class=\"p\">(<\/span><span class=\"nv\">$request_host<\/span><span class=\"p\">);<\/span><\/div><div class=\'line\' id=\'LC29\'><br/><\/div><div class=\'line\' id=\'LC30\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"k\">if<\/span> <span class=\"p\">(<\/span><span class=\"nv\">$current_sub<\/span> <span class=\"o\">==<\/span> <span class=\"s1\">&#39;fb&#39;<\/span><span class=\"p\">)<\/span> <span class=\"p\">{<\/span><\/div><div class=\'line\' id=\'LC31\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"c1\">// The subdomain is fb and needs no redirect<\/span><\/div><div class=\'line\' id=\'LC32\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"k\">return<\/span> <span class=\"k\">false<\/span><span class=\"p\">;<\/span><\/div><div class=\'line\' id=\'LC33\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"p\">}<\/span><\/div><div class=\'line\' id=\'LC34\'><br/><\/div><div class=\'line\' id=\'LC35\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"nv\">$info<\/span> <span class=\"o\">=<\/span> <span class=\"nx\">self<\/span><span class=\"o\">::<\/span><span class=\"na\">device_info<\/span><span class=\"p\">();<\/span><\/div><div class=\'line\' id=\'LC36\'><br/><\/div><div class=\'line\' id=\'LC37\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"k\">if<\/span> <span class=\"p\">(<\/span><span class=\"nb\">isset<\/span><span class=\"p\">(<\/span><span class=\"nv\">$info<\/span><span class=\"o\">-&gt;<\/span><span class=\"na\">isMobileDevice<\/span><span class=\"p\">)<\/span> <span class=\"o\">&amp;&amp;<\/span> <span class=\"nv\">$info<\/span><span class=\"o\">-&gt;<\/span><span class=\"na\">isMobileDevice<\/span><span class=\"p\">)<\/span> <span class=\"p\">{<\/span><\/div><div class=\'line\' id=\'LC38\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"k\">if<\/span> <span class=\"p\">(<\/span><span class=\"nb\">isset<\/span><span class=\"p\">(<\/span><span class=\"nv\">$info<\/span><span class=\"o\">-&gt;<\/span><span class=\"na\">Browser<\/span><span class=\"p\">)<\/span> <span class=\"o\">&amp;&amp;<\/span> <span class=\"nb\">in_array<\/span><span class=\"p\">(<\/span><span class=\"nv\">$info<\/span><span class=\"o\">-&gt;<\/span><span class=\"na\">Browser<\/span><span class=\"p\">,<\/span> <span class=\"nx\">self<\/span><span class=\"o\">::<\/span><span class=\"nv\">$tablets<\/span><span class=\"p\">))<\/span> <span class=\"p\">{<\/span><\/div><div class=\'line\' id=\'LC39\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"c1\">// This is a tablet, redirect to t. if needed<\/span><\/div><div class=\'line\' id=\'LC40\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"k\">return<\/span> <span class=\"nx\">self<\/span><span class=\"o\">::<\/span><span class=\"na\">_reconstruct_host<\/span><span class=\"p\">(<\/span><span class=\"nv\">$current_sub<\/span><span class=\"p\">,<\/span> <span class=\"s1\">&#39;t&#39;<\/span><span class=\"p\">,<\/span> <span class=\"nv\">$domain<\/span><span class=\"p\">);<\/span><\/div><div class=\'line\' id=\'LC41\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"p\">}<\/span><\/div><div class=\'line\' id=\'LC42\'><br/><\/div><div class=\'line\' id=\'LC43\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"c1\">// This is a mobile device, redirect to m. if needed<\/span><\/div><div class=\'line\' id=\'LC44\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"k\">return<\/span> <span class=\"nx\">self<\/span><span class=\"o\">::<\/span><span class=\"na\">_reconstruct_host<\/span><span class=\"p\">(<\/span><span class=\"nv\">$current_sub<\/span><span class=\"p\">,<\/span> <span class=\"s1\">&#39;m&#39;<\/span><span class=\"p\">,<\/span> <span class=\"nv\">$domain<\/span><span class=\"p\">);<\/span><\/div><div class=\'line\' id=\'LC45\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"p\">}<\/span><\/div><div class=\'line\' id=\'LC46\'><br/><\/div><div class=\'line\' id=\'LC47\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"c1\">// This is a normal device, as far as we know. Redirect if the subdomain isn&#39;t www or blank<\/span><\/div><div class=\'line\' id=\'LC48\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"k\">return<\/span> <span class=\"nx\">self<\/span><span class=\"o\">::<\/span><span class=\"na\">_reconstruct_host<\/span><span class=\"p\">(<\/span><span class=\"nv\">$current_sub<\/span><span class=\"p\">,<\/span> <span class=\"k\">array<\/span><span class=\"p\">(<\/span><span class=\"s1\">&#39;&#39;<\/span><span class=\"p\">,<\/span> <span class=\"s1\">&#39;www&#39;<\/span><span class=\"p\">),<\/span> <span class=\"nv\">$domain<\/span><span class=\"p\">);<\/span><\/div><div class=\'line\' id=\'LC49\'>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"p\">}<\/span><\/div><div class=\'line\' id=\'LC50\'><br/><\/div><div class=\'line\' id=\'LC51\'><span class=\"o\">...<\/span><\/div><div class=\'line\' id=\'LC52\'><span class=\"sd\">/**<\/span><\/div><div class=\'line\' id=\'LC53\'><span class=\"sd\">     * Retrieves or sets the device info. Calls to this which result in utilizing the Browscap<\/span><\/div><div class=\'line\' id=\'LC54\'><span class=\"sd\">     * library should be avoided for performance reasons.<\/span><\/div><div class=\'line\' id=\'LC55\'><span class=\"sd\">     *<\/span><\/div><div class=\'line\' id=\'LC56\'><span class=\"sd\">     * @param stdClass $info Device info to be set<\/span><\/div><div class=\'line\' id=\'LC57\'><span class=\"sd\">     * @return stdClass This request&#39;s device info<\/span><\/div><div class=\'line\' id=\'LC58\'><span class=\"sd\">     */<\/span><\/div><div class=\'line\' id=\'LC59\'>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"k\">public<\/span> <span class=\"k\">static<\/span> <span class=\"k\">function<\/span> <span class=\"nf\">device_info<\/span><span class=\"p\">(<\/span><span class=\"nx\">\\stdClass<\/span> <span class=\"nv\">$info<\/span> <span class=\"o\">=<\/span> <span class=\"k\">null<\/span><span class=\"p\">)<\/span> <span class=\"p\">{<\/span><\/div><div class=\'line\' id=\'LC60\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"k\">if<\/span> <span class=\"p\">(<\/span><span class=\"nv\">$info<\/span><span class=\"p\">)<\/span> <span class=\"p\">{<\/span><\/div><div class=\'line\' id=\'LC61\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"nx\">self<\/span><span class=\"o\">::<\/span><span class=\"nv\">$device_info<\/span> <span class=\"o\">=<\/span> <span class=\"nv\">$info<\/span><span class=\"p\">;<\/span><\/div><div class=\'line\' id=\'LC62\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"p\">}<\/span><\/div><div class=\'line\' id=\'LC63\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"k\">if<\/span> <span class=\"p\">(<\/span><span class=\"o\">!<\/span><span class=\"nb\">isset<\/span><span class=\"p\">(<\/span><span class=\"nx\">self<\/span><span class=\"o\">::<\/span><span class=\"nv\">$device_info<\/span><span class=\"p\">))<\/span> <span class=\"p\">{<\/span><\/div><div class=\'line\' id=\'LC64\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"c1\">// hack for varnish<\/span><\/div><div class=\'line\' id=\'LC65\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"k\">if<\/span> <span class=\"p\">(<\/span><span class=\"nb\">isset<\/span><span class=\"p\">(<\/span><span class=\"nv\">$_SERVER<\/span><span class=\"p\">[<\/span><span class=\"s1\">&#39;HTTP_X_FORD&#39;<\/span><span class=\"p\">])<\/span> <span class=\"o\">&amp;&amp;<\/span> <span class=\"nv\">$_SERVER<\/span><span class=\"p\">[<\/span><span class=\"s1\">&#39;HTTP_X_FORD&#39;<\/span><span class=\"p\">]<\/span> <span class=\"o\">===<\/span> <span class=\"s1\">&#39;Ford&#39;<\/span><span class=\"p\">)<\/span> <span class=\"p\">{<\/span><\/div><div class=\'line\' id=\'LC66\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"k\">if<\/span> <span class=\"p\">(<\/span><span class=\"nb\">isset<\/span><span class=\"p\">(<\/span><span class=\"nv\">$_SERVER<\/span><span class=\"p\">[<\/span><span class=\"s1\">&#39;HTTP_X_FORD_USER_AGENT&#39;<\/span><span class=\"p\">]))<\/span> <span class=\"p\">{<\/span><\/div><div class=\'line\' id=\'LC67\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"nv\">$_SERVER<\/span><span class=\"p\">[<\/span><span class=\"s1\">&#39;HTTP_USER_AGENT&#39;<\/span><span class=\"p\">]<\/span> <span class=\"o\">=<\/span> <span class=\"nv\">$_SERVER<\/span><span class=\"p\">[<\/span><span class=\"s1\">&#39;HTTP_X_FORD_USER_AGENT&#39;<\/span><span class=\"p\">];<\/span><\/div><div class=\'line\' id=\'LC68\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"p\">}<\/span><\/div><div class=\'line\' id=\'LC69\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"p\">}<\/span><\/div><div class=\'line\' id=\'LC70\'><br/><\/div><div class=\'line\' id=\'LC71\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"nv\">$bc<\/span> <span class=\"o\">=<\/span> <span class=\"k\">new<\/span> <span class=\"nx\">\\phpbrowscap\\Browscap<\/span><span class=\"p\">(<\/span><span class=\"nb\">sys_get_temp_dir<\/span><span class=\"p\">());<\/span><\/div><div class=\'line\' id=\'LC72\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"nx\">self<\/span><span class=\"o\">::<\/span><span class=\"nv\">$device_info<\/span> <span class=\"o\">=<\/span> <span class=\"nv\">$bc<\/span><span class=\"o\">-&gt;<\/span><span class=\"na\">getBrowser<\/span><span class=\"p\">();<\/span><\/div><div class=\'line\' id=\'LC73\'><br/><\/div><div class=\'line\' id=\'LC74\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"nv\">$user_agent<\/span> <span class=\"o\">=<\/span> <span class=\"nx\">self<\/span><span class=\"o\">::<\/span><span class=\"nv\">$device_info<\/span><span class=\"o\">-&gt;<\/span><span class=\"na\">browser_name<\/span><span class=\"p\">;<\/span><\/div><div class=\'line\' id=\'LC75\'><br/><\/div><div class=\'line\' id=\'LC76\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"c1\">// Run some basic regex tablet detection<\/span><\/div><div class=\'line\' id=\'LC77\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"k\">if<\/span> <span class=\"p\">(<\/span><span class=\"nv\">$user_agent<\/span> <span class=\"o\">&amp;&amp;<\/span> <span class=\"p\">(<\/span><span class=\"nv\">$tablet<\/span> <span class=\"o\">=<\/span> <span class=\"nx\">self<\/span><span class=\"o\">::<\/span><span class=\"na\">_tablet_detect<\/span><span class=\"p\">(<\/span><span class=\"nv\">$user_agent<\/span><span class=\"p\">)))<\/span> <span class=\"p\">{<\/span><\/div><div class=\'line\' id=\'LC78\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"nx\">self<\/span><span class=\"o\">::<\/span><span class=\"nv\">$device_info<\/span><span class=\"o\">-&gt;<\/span><span class=\"na\">isMobileDevice<\/span> <span class=\"o\">=<\/span> <span class=\"k\">true<\/span><span class=\"p\">;<\/span><\/div><div class=\'line\' id=\'LC79\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"nx\">self<\/span><span class=\"o\">::<\/span><span class=\"nv\">$device_info<\/span><span class=\"o\">-&gt;<\/span><span class=\"na\">Browser<\/span> <span class=\"o\">=<\/span> <span class=\"s1\">&#39;Tablet&#39;<\/span><span class=\"p\">;<\/span><\/div><div class=\'line\' id=\'LC80\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"nx\">self<\/span><span class=\"o\">::<\/span><span class=\"nv\">$device_info<\/span><span class=\"o\">-&gt;<\/span><span class=\"na\">TabletKeyword<\/span> <span class=\"o\">=<\/span> <span class=\"nv\">$tablet<\/span><span class=\"p\">;<\/span><\/div><div class=\'line\' id=\'LC81\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"p\">}<\/span><\/div><div class=\'line\' id=\'LC82\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"p\">}<\/span><\/div><div class=\'line\' id=\'LC83\'><br/><\/div><div class=\'line\' id=\'LC84\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"k\">return<\/span> <span class=\"nx\">self<\/span><span class=\"o\">::<\/span><span class=\"nv\">$device_info<\/span><span class=\"p\">;<\/span><\/div><div class=\'line\' id=\'LC85\'>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"p\">}<\/span><\/div><div class=\'line\' id=\'LC86\'><br/><\/div><div class=\'line\' id=\'LC87\'><span class=\"o\">...<\/span><\/div><div class=\'line\' id=\'LC88\'><br/><\/div><div class=\'line\' id=\'LC89\'><span class=\"k\">protected<\/span> <span class=\"k\">static<\/span> <span class=\"k\">function<\/span> <span class=\"nf\">_reconstruct_host<\/span><span class=\"p\">(<\/span><span class=\"nv\">$current_sub<\/span><span class=\"p\">,<\/span> <span class=\"nv\">$desired_sub<\/span><span class=\"p\">,<\/span> <span class=\"nv\">$domain<\/span><span class=\"p\">)<\/span> <span class=\"p\">{<\/span><\/div><div class=\'line\' id=\'LC90\'><br/><\/div><div class=\'line\' id=\'LC91\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"k\">if<\/span> <span class=\"p\">(<\/span><span class=\"o\">!<\/span><span class=\"nb\">is_array<\/span><span class=\"p\">(<\/span><span class=\"nv\">$desired_sub<\/span><span class=\"p\">))<\/span> <span class=\"p\">{<\/span><\/div><div class=\'line\' id=\'LC92\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"nv\">$desired_sub<\/span> <span class=\"o\">=<\/span> <span class=\"k\">array<\/span><span class=\"p\">(<\/span><span class=\"nv\">$desired_sub<\/span><span class=\"p\">);<\/span><\/div><div class=\'line\' id=\'LC93\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"p\">}<\/span><\/div><div class=\'line\' id=\'LC94\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"nv\">$return_host<\/span> <span class=\"o\">=<\/span> <span class=\"s1\">&#39;&#39;<\/span><span class=\"p\">;<\/span><\/div><div class=\'line\' id=\'LC95\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"k\">if<\/span> <span class=\"p\">(<\/span><span class=\"nb\">in_array<\/span><span class=\"p\">(<\/span><span class=\"nv\">$current_sub<\/span><span class=\"p\">,<\/span> <span class=\"nv\">$desired_sub<\/span><span class=\"p\">))<\/span> <span class=\"p\">{<\/span><\/div><div class=\'line\' id=\'LC96\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"k\">return<\/span> <span class=\"k\">false<\/span><span class=\"p\">;<\/span><\/div><div class=\'line\' id=\'LC97\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"p\">}<\/span> <span class=\"k\">else<\/span> <span class=\"k\">if<\/span> <span class=\"p\">(<\/span><span class=\"nb\">in_array<\/span><span class=\"p\">(<\/span><span class=\"nv\">$current_sub<\/span><span class=\"p\">,<\/span> <span class=\"nx\">self<\/span><span class=\"o\">::<\/span><span class=\"nv\">$valid_subdomains<\/span><span class=\"p\">))<\/span> <span class=\"p\">{<\/span><\/div><div class=\'line\' id=\'LC98\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"c1\">// We need to replace the current subdomain for the redirect<\/span><\/div><div class=\'line\' id=\'LC99\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"nv\">$desired_sub<\/span> <span class=\"o\">=<\/span> <span class=\"nb\">current<\/span><span class=\"p\">(<\/span><span class=\"nv\">$desired_sub<\/span><span class=\"p\">);<\/span><\/div><div class=\'line\' id=\'LC100\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"nv\">$return_host<\/span> <span class=\"o\">=<\/span> <span class=\"s2\">&quot;<\/span><span class=\"si\">$desired_sub<\/span><span class=\"s2\">.<\/span><span class=\"si\">$domain<\/span><span class=\"s2\">&quot;<\/span><span class=\"p\">;<\/span><\/div><div class=\'line\' id=\'LC101\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"p\">}<\/span> <span class=\"k\">else<\/span> <span class=\"p\">{<\/span><\/div><div class=\'line\' id=\'LC102\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"c1\">// No recognized subdomain, so let&#39;s prepend the appropriate subdomain<\/span><\/div><div class=\'line\' id=\'LC103\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"nv\">$desired_sub<\/span> <span class=\"o\">=<\/span> <span class=\"nb\">current<\/span><span class=\"p\">(<\/span><span class=\"nv\">$desired_sub<\/span><span class=\"p\">);<\/span><\/div><div class=\'line\' id=\'LC104\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"c1\">// If the primary desired subdomain is blank, and the current subdomain is unrecognized,<\/span><\/div><div class=\'line\' id=\'LC105\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"c1\">// just assume that we don&#39;t need to redirect<\/span><\/div><div class=\'line\' id=\'LC106\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"k\">if<\/span> <span class=\"p\">(<\/span><span class=\"nv\">$desired_sub<\/span> <span class=\"o\">===<\/span> <span class=\"s1\">&#39;&#39;<\/span><span class=\"p\">)<\/span> <span class=\"k\">return<\/span> <span class=\"k\">false<\/span><span class=\"p\">;<\/span><\/div><div class=\'line\' id=\'LC107\'><br/><\/div><div class=\'line\' id=\'LC108\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"nv\">$return_host<\/span> <span class=\"o\">=<\/span> <span class=\"s2\">&quot;<\/span><span class=\"si\">$desired_sub<\/span><span class=\"s2\">.<\/span><span class=\"si\">$domain<\/span><span class=\"s2\">&quot;<\/span><span class=\"p\">;<\/span><\/div><div class=\'line\' id=\'LC109\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"p\">}<\/span><\/div><div class=\'line\' id=\'LC110\'><br/><\/div><div class=\'line\' id=\'LC111\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"c1\">// If the return host begins with a ., replace it<\/span><\/div><div class=\'line\' id=\'LC112\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"k\">if<\/span> <span class=\"p\">(<\/span><span class=\"nb\">strpos<\/span><span class=\"p\">(<\/span><span class=\"nv\">$return_host<\/span><span class=\"p\">,<\/span> <span class=\"s1\">&#39;.&#39;<\/span><span class=\"p\">)<\/span> <span class=\"o\">===<\/span> <span class=\"mi\">0<\/span><span class=\"p\">)<\/span> <span class=\"nv\">$return_host<\/span> <span class=\"o\">=<\/span> <span class=\"nx\">substr<\/span><span class=\"p\">(<\/span><span class=\"nv\">$return_host<\/span><span class=\"p\">,<\/span> <span class=\"mi\">1<\/span><span class=\"p\">);<\/span><\/div><div class=\'line\' id=\'LC113\'><br/><\/div><div class=\'line\' id=\'LC114\'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"k\">return<\/span> <span class=\"nv\">$return_host<\/span><span class=\"p\">;<\/span><\/div><div class=\'line\' id=\'LC115\'>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"p\">}<\/span><\/div><div class=\'line\' id=\'LC116\'><br/><\/div><\/pre><\/div>\n          <\/div>\n\n          <div class=\"gist-meta\">\n            <a href=\"https://gist.github.com/raw/a5e484043fdbdf1a807a/0f2affbfb34fd7f4b3c19260c8ccc6020e44bcd3/gistfile1.aw\" style=\"float:right;\">view raw<\/a>\n            <a href=\"https://gist.github.com/a5e484043fdbdf1a807a#file_gistfile1.aw\" style=\"float:right;margin-right:10px;color:#666\">gistfile1.aw<\/a>\n            <a href=\"https://gist.github.com/a5e484043fdbdf1a807a\">This Gist<\/a> brought to you by <a href=\"http://github.com\">GitHub<\/a>.\n          <\/div>\n        <\/div>\n<\/div>\n')
--></script>
